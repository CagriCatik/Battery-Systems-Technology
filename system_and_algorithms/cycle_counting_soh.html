<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Cycle Counting SOH - Battery Management Systems</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../src/custom.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Battery Management Systems</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="cycle-counting-and-state-of-health-soh"><a class="header" href="#cycle-counting-and-state-of-health-soh">Cycle Counting and State of Health (SoH)</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Cycle Counting and State of Health (SoH) are pivotal components of Battery Management Systems (BMS). These metrics enable the effective monitoring of battery usage and health, ensuring optimal performance, reliability, and longevity. This documentation provides an in-depth, detailed, and seamless explanation of the methodologies, algorithms, and challenges associated with cycle counting and SoH estimation, offering insights suitable for industry professionals and engineers.</p>
<hr />
<h2 id="cycle-counting"><a class="header" href="#cycle-counting">Cycle Counting</a></h2>
<h3 id="1-overview"><a class="header" href="#1-overview">1. Overview</a></h3>
<p>Cycle counting determines the number of complete charge-discharge cycles a battery undergoes over its lifetime. Understanding the number of cycles is crucial for predicting battery degradation and estimating remaining life.</p>
<hr />
<h3 id="2-defining-a-battery-cycle"><a class="header" href="#2-defining-a-battery-cycle">2. Defining a Battery Cycle</a></h3>
<p>A cycle is defined as a full charge from a minimum SoC (e.g., 20%) to a maximum SoC (e.g., 100%), followed by a discharge back to the starting SoC. Partial cycles are accumulated to represent equivalent full cycles.</p>
<h4 id="key-definitions"><a class="header" href="#key-definitions">Key Definitions</a></h4>
<ul>
<li>Charge Cycle: The transition of a battery’s SoC from a low to a high value.</li>
<li>Discharge Cycle: The reverse process of depleting the battery from a high SoC to a lower SoC.</li>
</ul>
<h4 id="example"><a class="header" href="#example">Example</a></h4>
<p>If a battery is discharged from 100% to 50% and then recharged to 100%, it is considered half a cycle. Two such operations would count as one full cycle.</p>
<div class="table-wrapper"><table><thead><tr><th>Cycle Phase</th><th>Start SoC (%)</th><th>End SoC (%)</th><th>Description</th></tr></thead><tbody>
<tr><td>Charging</td><td>20</td><td>100</td><td>Full charge from 20% to 100%.</td></tr>
<tr><td>Discharging</td><td>100</td><td>20</td><td>Full discharge from 100% to 20%.</td></tr>
</tbody></table>
</div>
<hr />
<h3 id="3-challenges-in-cycle-counting"><a class="header" href="#3-challenges-in-cycle-counting">3. Challenges in Cycle Counting</a></h3>
<h4 id="31-no-direct-measurement"><a class="header" href="#31-no-direct-measurement">3.1 No Direct Measurement</a></h4>
<p>Cycles cannot be directly measured by sensors; they must be inferred using algorithms based on current, voltage, and SoC.</p>
<h4 id="32-nonlinear-battery-behavior"><a class="header" href="#32-nonlinear-battery-behavior">3.2 Nonlinear Battery Behavior</a></h4>
<p>Factors like varying charge/discharge rates, temperature, and battery chemistry introduce complexity in defining and counting cycles.</p>
<h4 id="33-duty-profiles"><a class="header" href="#33-duty-profiles">3.3 Duty Profiles</a></h4>
<ul>
<li>Charge Duty: The total energy added to the battery during a charge event.</li>
<li>Discharge Duty: The total energy removed from the battery during a discharge event.</li>
</ul>
<p>These profiles help in accurately estimating partial and full cycles.</p>
<hr />
<h3 id="4-cycle-counting-algorithm"><a class="header" href="#4-cycle-counting-algorithm">4. Cycle Counting Algorithm</a></h3>
<h4 id="step-1-monitoring-soc"><a class="header" href="#step-1-monitoring-soc">Step 1: Monitoring SoC</a></h4>
<p>Continuously monitor SoC using battery voltage and current sensors.</p>
<h4 id="step-2-identifying-cycles"><a class="header" href="#step-2-identifying-cycles">Step 2: Identifying Cycles</a></h4>
<p>Define a full cycle as the SoC changing from a low value to a high value and back to the starting point:
[
\text{Cycle Count} = \sum \frac{\Delta \text{SoC}}{100}
]</p>
<h4 id="step-3-accumulating-partial-cycles"><a class="header" href="#step-3-accumulating-partial-cycles">Step 3: Accumulating Partial Cycles</a></h4>
<p>Track incomplete cycles by summing fractional changes in SoC. For example:</p>
<ul>
<li>Discharge from 100% to 50% → 0.5 cycles.</li>
<li>Charge from 50% to 100% → 0.5 cycles.</li>
<li>Total = 1 full cycle.</li>
</ul>
<h4 id="step-4-logging-and-updating"><a class="header" href="#step-4-logging-and-updating">Step 4: Logging and Updating</a></h4>
<p>Maintain a counter to record accumulated cycles.</p>
<hr />
<h3 id="5-duty-calculation-for-enhanced-accuracy"><a class="header" href="#5-duty-calculation-for-enhanced-accuracy">5. Duty Calculation for Enhanced Accuracy</a></h3>
<h4 id="charging-duty"><a class="header" href="#charging-duty">Charging Duty</a></h4>
<p>The charge duty reflects the energy added to the battery during a charging event:
[
\text{Duty}<em>{\text{charge}} = \text{End SoC}</em>{\text{charge}} - \text{Start SoC}_{\text{charge}}
]</p>
<h4 id="discharging-duty"><a class="header" href="#discharging-duty">Discharging Duty</a></h4>
<p>The discharge duty reflects the energy drawn during discharging:
[
\text{Duty}<em>{\text{discharge}} = \text{Start SoC}</em>{\text{discharge}} - \text{End SoC}_{\text{discharge}}
]</p>
<h4 id="total-duty"><a class="header" href="#total-duty">Total Duty</a></h4>
<p>The sum of charging and discharging duties helps refine cycle calculations:
[
\text{Total Duty} = \text{Duty}<em>{\text{charge}} + \text{Duty}</em>{\text{discharge}}
]</p>
<hr />
<h2 id="state-of-health-soh"><a class="header" href="#state-of-health-soh">State of Health (SoH)</a></h2>
<h3 id="1-overview-1"><a class="header" href="#1-overview-1">1. Overview</a></h3>
<p>State of Health (SoH) quantifies the current capacity of a battery compared to its original capacity when new. It serves as a measure of battery aging and remaining usability.</p>
<h4 id="formula"><a class="header" href="#formula">Formula</a></h4>
<p>[
\text{SoH} = \frac{\text{Remaining Capacity}}{\text{Rated Capacity}} \times 100
]</p>
<hr />
<h3 id="2-capacity-degradation"><a class="header" href="#2-capacity-degradation">2. Capacity Degradation</a></h3>
<p>Battery capacity diminishes with usage due to cycle aging, temperature extremes, and internal resistance growth. The relationship between cycle count and capacity loss is often modeled using a Cycle vs. Capacity Loss Chart.</p>
<div class="table-wrapper"><table><thead><tr><th>Cycle Count</th><th>Remaining Capacity (% of Rated)</th></tr></thead><tbody>
<tr><td>0</td><td>100%</td></tr>
<tr><td>500</td><td>90%</td></tr>
<tr><td>1000</td><td>80%</td></tr>
<tr><td>1500</td><td>70%</td></tr>
</tbody></table>
</div>
<h4 id="lookup-table-implementation"><a class="header" href="#lookup-table-implementation">Lookup Table Implementation</a></h4>
<p>The Cycle vs. Capacity Loss Chart is converted into a lookup table for algorithmic use:</p>
<ol>
<li>Use the current cycle count as input.</li>
<li>Interpolate to find the remaining capacity.</li>
</ol>
<hr />
<h3 id="3-soh-estimation-algorithm"><a class="header" href="#3-soh-estimation-algorithm">3. SoH Estimation Algorithm</a></h3>
<h4 id="step-1-retrieve-cycle-count"><a class="header" href="#step-1-retrieve-cycle-count">Step 1: Retrieve Cycle Count</a></h4>
<p>Calculate or retrieve the total cycles completed using the cycle counting algorithm.</p>
<h4 id="step-2-estimate-remaining-capacity"><a class="header" href="#step-2-estimate-remaining-capacity">Step 2: Estimate Remaining Capacity</a></h4>
<p>Map the cycle count to remaining capacity using the lookup table:
[
\text{Remaining Capacity} = f(\text{Cycle Count})
]</p>
<h4 id="step-3-calculate-soh"><a class="header" href="#step-3-calculate-soh">Step 3: Calculate SoH</a></h4>
<p>Calculate SoH as the ratio of remaining capacity to rated capacity:
[
\text{SoH} = \frac{\text{Remaining Capacity}}{\text{Rated Capacity}} \times 100
]</p>
<hr />
<h3 id="4-duty-corrected-soh"><a class="header" href="#4-duty-corrected-soh">4. Duty-Corrected SoH</a></h3>
<p>Integrating duty calculations enhances the accuracy of SoH estimation:
[
\text{SoH}<em>{\text{corrected}} = \frac{\text{Remaining Capacity}</em>{\text{duty}}}{\text{Rated Capacity}} \times 100
]</p>
<hr />
<h3 id="5-matlab-implementation-of-soh"><a class="header" href="#5-matlab-implementation-of-soh">5. MATLAB Implementation of SoH</a></h3>
<h4 id="algorithm-design"><a class="header" href="#algorithm-design">Algorithm Design</a></h4>
<ol>
<li>Create a Cycle vs. Capacity Loss Lookup Table.</li>
<li>Implement the SoH estimation algorithm using cycle count and duty data.</li>
</ol>
<h4 id="pseudo-code"><a class="header" href="#pseudo-code">Pseudo-Code</a></h4>
<pre><code class="language-matlab">% Define battery parameters
rated_capacity = 100; % in Ah
cycle_count = 0;

% Define Lookup Table (Cycle vs Capacity Loss)
lookup_table = [0, 100; 500, 90; 1000, 80; 1500, 70];

% Cycle Counting Algorithm
if start_soc &lt; end_soc
    cycle_increment = (end_soc - start_soc) / 100;
    cycle_count = cycle_count + cycle_increment;
end

% SoH Estimation
remaining_capacity = interp1(lookup_table(:,1), lookup_table(:,2), cycle_count, 'linear', 'extrap');
SoH = (remaining_capacity / rated_capacity) * 100;

% Output Results
disp(['Current SoH: ', num2str(SoH), '%']);
</code></pre>
<hr />
<h2 id="key-considerations-for-implementation"><a class="header" href="#key-considerations-for-implementation">Key Considerations for Implementation</a></h2>
<ol>
<li>Data Accuracy: Sensor precision for voltage, current, and SoC is critical.</li>
<li>Dynamic Operating Conditions: Account for varying usage patterns, temperature, and load profiles.</li>
<li>Battery Chemistry: Tailor algorithms to specific chemistries (e.g., lithium-ion, lead-acid).</li>
</ol>
<hr />
<h2 id="future-enhancements"><a class="header" href="#future-enhancements">Future Enhancements</a></h2>
<ul>
<li>Advanced Cycle Counting:
<ul>
<li>Implement Kalman filters to account for noise and inaccuracies.</li>
<li>Use machine learning to predict cycles under variable conditions.</li>
</ul>
</li>
<li>State of Power (SoP):
<ul>
<li>Include real-time power delivery capabilities in health estimation.</li>
</ul>
</li>
<li>Integrated Systems:
<ul>
<li>Embed SoH algorithms in microcontrollers or FPGAs for real-time BMS applications.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>Cycle counting and SoH estimation are essential for efficient battery management. Accurate algorithms ensure prolonged battery life, safety, and reliability. By implementing these techniques in MATLAB or embedded systems, engineers can enhance battery performance and predict degradation trends for real-world applications.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../system_and_algorithms/soc_estimation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../system_and_algorithms/soh_algorithm.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../system_and_algorithms/soc_estimation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../system_and_algorithms/soh_algorithm.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
