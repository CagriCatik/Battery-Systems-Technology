<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-theory/bms_architecture/initial_soc" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Initial SoC &amp; SoH Estimation |  Battery Systems and Technology</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://CagriCatik.github.io/Battery-Systems-Technology/img/undraw_online.svg"><meta data-rh="true" name="twitter:image" content="https://CagriCatik.github.io/Battery-Systems-Technology/img/undraw_online.svg"><meta data-rh="true" property="og:url" content="https://CagriCatik.github.io/Battery-Systems-Technology/docs/theory/bms_architecture/initial_soc"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Initial SoC &amp; SoH Estimation |  Battery Systems and Technology"><meta data-rh="true" name="description" content="The State of Charge (SoC) and State of Health (SoH) are fundamental parameters in Battery Management Systems (BMS). Accurate estimation of these metrics is crucial for ensuring the optimal performance, safety, and longevity of battery systems used in applications such as electric vehicles (EVs), renewable energy storage, and portable electronics. This chapter provides a comprehensive exploration of the methods and algorithms employed for initial SoC and SoH estimation, detailing the mathematical and logical processes involved."><meta data-rh="true" property="og:description" content="The State of Charge (SoC) and State of Health (SoH) are fundamental parameters in Battery Management Systems (BMS). Accurate estimation of these metrics is crucial for ensuring the optimal performance, safety, and longevity of battery systems used in applications such as electric vehicles (EVs), renewable energy storage, and portable electronics. This chapter provides a comprehensive exploration of the methods and algorithms employed for initial SoC and SoH estimation, detailing the mathematical and logical processes involved."><link data-rh="true" rel="icon" href="/Battery-Systems-Technology/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://CagriCatik.github.io/Battery-Systems-Technology/docs/theory/bms_architecture/initial_soc"><link data-rh="true" rel="alternate" href="https://CagriCatik.github.io/Battery-Systems-Technology/docs/theory/bms_architecture/initial_soc" hreflang="en"><link data-rh="true" rel="alternate" href="https://CagriCatik.github.io/Battery-Systems-Technology/docs/theory/bms_architecture/initial_soc" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/Battery-Systems-Technology/blog/rss.xml" title=" Battery Systems and Technology RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Battery-Systems-Technology/blog/atom.xml" title=" Battery Systems and Technology Atom Feed">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-R4556vVJtIc0EJ3NKnM5ePcM78Zv5e+/ff+f6aZwYzZjnj84pK8i0PZyNnO+g0OQ" crossorigin="anonymous"><link rel="stylesheet" href="/Battery-Systems-Technology/assets/css/styles.5765a3ec.css">
<script src="/Battery-Systems-Technology/assets/js/runtime~main.3402a0df.js" defer="defer"></script>
<script src="/Battery-Systems-Technology/assets/js/main.60a1c0e5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Battery-Systems-Technology/"><div class="navbar__logo"><img src="/Battery-Systems-Technology/img/logo.png" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Battery-Systems-Technology/img/logo.png" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/Battery-Systems-Technology/docs/theory/fundamentals/getting-started">Fundamentals of Battery Technology</a><a class="navbar__item navbar__link" href="/Battery-Systems-Technology/docs/theory/aging_degradation/getting-started">Aging and Degradation</a><a class="navbar__item navbar__link" href="/Battery-Systems-Technology/docs/theory/chemistry_design_principles/getting-started">Chemistry and Design Principles</a><a class="navbar__item navbar__link" href="/Battery-Systems-Technology/docs/theory/battery_pack/getting_started">Battery Pack Engineering</a><a class="navbar__item navbar__link" href="/Battery-Systems-Technology/docs/theory/thermal_management/getting_started">Thermal Management</a><a class="navbar__item navbar__link" href="/Battery-Systems-Technology/docs/theory/battery_characteristics/getting_started">Characteristics and Technical Specifications</a><a class="navbar__item navbar__link" href="/Battery-Systems-Technology/docs/theory/battery_sizing/getting_started">Sizing and Optimization</a><a class="navbar__item navbar__link" href="/Battery-Systems-Technology/docs/theory/bms/getting_started">Battery Management System</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Battery-Systems-Technology/docs/theory/bms_architecture/getting_started">Design and Architecture</a><a class="navbar__item navbar__link" href="/Battery-Systems-Technology/docs/theory/modeling_testing/getting_started">Modeling and Testing</a><a class="navbar__item navbar__link" href="/Battery-Systems-Technology/docs/glossary/electrical_concepts">Glossary</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Battery-Systems-Technology/docs/theory/bms_architecture/getting_started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Battery-Systems-Technology/docs/theory/bms_architecture/bms_architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Battery-Systems-Technology/docs/theory/bms_architecture/bms_control">Control System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Battery-Systems-Technology/docs/theory/bms_architecture/development_trends">Development Trends</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/Battery-Systems-Technology/docs/theory/bms_architecture/initial_soc">Initial SoC &amp; SoH Estimation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Battery-Systems-Technology/docs/theory/bms_architecture/bms_design">BMS Design</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Battery-Systems-Technology/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Initial SoC &amp; SoH Estimation</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Initial SoC &amp; SoH Estimation</h1></header>
<p>The State of Charge (SoC) and State of Health (SoH) are fundamental parameters in Battery Management Systems (BMS). Accurate estimation of these metrics is crucial for ensuring the optimal performance, safety, and longevity of battery systems used in applications such as electric vehicles (EVs), renewable energy storage, and portable electronics. This chapter provides a comprehensive exploration of the methods and algorithms employed for initial SoC and SoH estimation, detailing the mathematical and logical processes involved.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-overview-of-soc-and-soh-estimation">1. Overview of SoC and SoH Estimation<a href="#1-overview-of-soc-and-soh-estimation" class="hash-link" aria-label="Direct link to 1. Overview of SoC and SoH Estimation" title="Direct link to 1. Overview of SoC and SoH Estimation">​</a></h2>
<p>Understanding the State of Charge (SoC) and State of Health (SoH) is essential for effective battery management. These parameters provide insights into the battery&#x27;s current capacity and its ability to perform over time.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-state-of-charge-soc">1.1 State of Charge (SoC)<a href="#11-state-of-charge-soc" class="hash-link" aria-label="Direct link to 1.1 State of Charge (SoC)" title="Direct link to 1.1 State of Charge (SoC)">​</a></h3>
<p><strong>State of Charge (SoC)</strong> represents the remaining capacity of the battery as a percentage of its maximum capacity. It indicates how much energy is left in the battery at any given time and is crucial for applications like EVs to predict driving range and manage charging cycles effectively.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-state-of-health-soh">1.2 State of Health (SoH)<a href="#12-state-of-health-soh" class="hash-link" aria-label="Direct link to 1.2 State of Health (SoH)" title="Direct link to 1.2 State of Health (SoH)">​</a></h3>
<p><strong>State of Health (SoH)</strong> reflects the overall condition of the battery, indicating its ability to store and deliver energy compared to its original capacity. SoH accounts for factors such as capacity loss, internal resistance increase, and overall degradation due to aging and usage patterns.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-initial-soc-estimation">2. Initial SoC Estimation<a href="#2-initial-soc-estimation" class="hash-link" aria-label="Direct link to 2. Initial SoC Estimation" title="Direct link to 2. Initial SoC Estimation">​</a></h2>
<p>Accurate initial SoC estimation is vital for the BMS to provide reliable battery status from the outset. Various methods are employed to determine the initial SoC, each with its advantages and limitations.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-open-circuit-voltage-ocv-method">2.1 Open-Circuit Voltage (OCV) Method<a href="#21-open-circuit-voltage-ocv-method" class="hash-link" aria-label="Direct link to 2.1 Open-Circuit Voltage (OCV) Method" title="Direct link to 2.1 Open-Circuit Voltage (OCV) Method">​</a></h3>
<p>The Open-Circuit Voltage (OCV) method estimates SoC based on the relationship between the battery&#x27;s voltage and its SoC when the battery is at rest (i.e., no load or charge is applied). This method is straightforward but requires the battery to be in a rested state to obtain accurate readings.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps:<a href="#steps" class="hash-link" aria-label="Direct link to Steps:" title="Direct link to Steps:">​</a></h4>
<ol>
<li><strong>Measure Open-Circuit Voltage</strong>: Ensure the battery is at rest, then measure its voltage.</li>
<li><strong>Map OCV to SoC</strong>: Use a pre-defined OCV-SoC curve or lookup table to estimate the SoC based on the measured OCV.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example:<a href="#example" class="hash-link" aria-label="Direct link to Example:" title="Direct link to Example:">​</a></h4>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Function to estimate SoC using OCV Method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">estimate_SOC_OCV</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> ocv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Example OCV-SoC lookup table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> ocv_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">3.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4.2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Voltage in volts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> soc_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">90</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// SoC in percentage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> table_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ocv_table</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ocv_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Find the closest OCV value in the table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> table_size </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ocv </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> ocv_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> ocv </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> ocv_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Linear interpolation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> slope </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">soc_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> soc_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ocv_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> ocv_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> soc_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> slope </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ocv </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> ocv_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> soc_table</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">table_size </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Return 100% if OCV exceeds table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Note: The OCV-SoC relationship varies with battery chemistry and temperature. Calibration is essential for accurate estimation.</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-coulomb-counting-method">2.2 Coulomb Counting Method<a href="#22-coulomb-counting-method" class="hash-link" aria-label="Direct link to 2.2 Coulomb Counting Method" title="Direct link to 2.2 Coulomb Counting Method">​</a></h3>
<p>Coulomb counting estimates SoC by integrating the current flowing into or out of the battery over time. This method provides dynamic SoC estimation but requires an accurate initial SoC value and precise current measurements to minimize cumulative errors.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="steps-1">Steps:<a href="#steps-1" class="hash-link" aria-label="Direct link to Steps:" title="Direct link to Steps:">​</a></h4>
<ol>
<li><strong>Measure Current Flow</strong>: Continuously measure the current entering (charging) or leaving (discharging) the battery.</li>
<li><strong>Integrate Current Over Time</strong>: Calculate the total charge added or removed by integrating the current over the elapsed time.</li>
<li><strong>Update SoC</strong>: Adjust the initial SoC based on the integrated charge.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-1">Example:<a href="#example-1" class="hash-link" aria-label="Direct link to Example:" title="Direct link to Example:">​</a></h4>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Function to estimate SoC using Coulomb Counting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">estimate_SOC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> current</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> delta_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> initial_SOC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> battery_capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// current: Current in amperes (A)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// delta_time: Time interval in seconds (s)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// initial_SOC: SoC at the beginning of the interval (%)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// battery_capacity: Total battery capacity in ampere-hours (Ah)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Convert battery capacity to coulombs (1 Ah = 3600 C)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> battery_capacity_coulombs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> battery_capacity </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3600.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Calculate charge change (Coulombs)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> delta_charge </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> current </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> delta_time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Update SoC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> new_SOC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> initial_SOC </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">delta_charge </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> battery_capacity_coulombs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Clamp SoC between 0% and 100%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">new_SOC </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> new_SOC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">new_SOC </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> new_SOC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> new_SOC</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Note: Accurate current measurement and minimal sensor drift are critical for reducing errors in Coulomb counting.</em></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-initial-soh-estimation">3. Initial SoH Estimation<a href="#3-initial-soh-estimation" class="hash-link" aria-label="Direct link to 3. Initial SoH Estimation" title="Direct link to 3. Initial SoH Estimation">​</a></h2>
<p>State of Health (SoH) estimation evaluates the battery&#x27;s condition and predicts its remaining useful life. Accurate SoH assessment helps in proactive maintenance and ensures reliability in applications.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-capacity-loss-calculation">3.1 Capacity Loss Calculation<a href="#31-capacity-loss-calculation" class="hash-link" aria-label="Direct link to 3.1 Capacity Loss Calculation" title="Direct link to 3.1 Capacity Loss Calculation">​</a></h3>
<p>Capacity loss quantifies the reduction in the battery&#x27;s ability to store energy compared to its original capacity. It is influenced by factors like the number of charge-discharge cycles, depth of discharge, and operating temperatures.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="steps-2">Steps:<a href="#steps-2" class="hash-link" aria-label="Direct link to Steps:" title="Direct link to Steps:">​</a></h4>
<ol>
<li><strong>Determine Charge-Discharge Cycles</strong>: Track the number of complete and partial charge-discharge cycles the battery has undergone.</li>
<li><strong>Estimate Capacity Loss</strong>: Use empirical models or lookup tables to estimate capacity loss based on the cycle count.</li>
<li><strong>Calculate Current Capacity</strong>: Subtract the estimated capacity loss from the original capacity.</li>
<li><strong>Compute SoH</strong>: Express SoH as the ratio of current capacity to original capacity.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="formula">Formula:<a href="#formula" class="hash-link" aria-label="Direct link to Formula:" title="Direct link to Formula:">​</a></h4>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>SoH</mtext><mo>=</mo><mrow><mo fence="true">(</mo><mfrac><mtext>Current Capacity</mtext><mtext>Original Capacity</mtext></mfrac><mo fence="true">)</mo></mrow><mo>×</mo><mn>100</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">\text{SoH} = \left( \frac{\text{Current Capacity}}{\text{Original Capacity}} \right) \times 100\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord text"><span class="mord">SoH</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord text"><span class="mord">Original Capacity</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord text"><span class="mord">Current Capacity</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em"></span><span class="mord">100%</span></span></span></span></span>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-2">Example:<a href="#example-2" class="hash-link" aria-label="Direct link to Example:" title="Direct link to Example:">​</a></h4>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Function to estimate SoH based on capacity loss</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">estimate_SOH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> current_capacity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> original_capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_capacity </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> original_capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-cycle-counting">3.2 Cycle Counting<a href="#32-cycle-counting" class="hash-link" aria-label="Direct link to 3.2 Cycle Counting" title="Direct link to 3.2 Cycle Counting">​</a></h3>
<p>Cycle counting involves tracking the number of charge-discharge cycles a battery has experienced. Each cycle contributes to the gradual degradation of the battery&#x27;s capacity and overall health.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="steps-3">Steps:<a href="#steps-3" class="hash-link" aria-label="Direct link to Steps:" title="Direct link to Steps:">​</a></h4>
<ol>
<li><strong>Measure Depth of Discharge (DoD)</strong>: For each cycle, determine how deeply the battery was discharged.</li>
<li><strong>Accumulate Partial Cycles</strong>: Account for partial cycles by normalizing DoD to equivalent full cycles.</li>
<li><strong>Estimate Total Cycles</strong>: Sum the equivalent full cycles to determine the total cycle count.</li>
<li><strong>Map Cycles to Capacity Loss</strong>: Use a predefined model or lookup table to estimate capacity loss based on total cycles.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-3">Example:<a href="#example-3" class="hash-link" aria-label="Direct link to Example:" title="Direct link to Example:">​</a></h4>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Function to estimate SoH based on cycle counting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">estimate_SOH_cycles</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> total_cycles</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> capacity_loss_per_cycle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> total_capacity_loss </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> total_cycles </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> capacity_loss_per_cycle</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> soh </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100.0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> total_capacity_loss</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">soh </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> soh </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> soh</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Note: The capacity loss per cycle varies with battery chemistry and operating conditions.</em></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-mathematical-and-logical-steps-for-soc-and-soh-estimation">4. Mathematical and Logical Steps for SoC and SoH Estimation<a href="#4-mathematical-and-logical-steps-for-soc-and-soh-estimation" class="hash-link" aria-label="Direct link to 4. Mathematical and Logical Steps for SoC and SoH Estimation" title="Direct link to 4. Mathematical and Logical Steps for SoC and SoH Estimation">​</a></h2>
<p>Accurate SoC and SoH estimation involves a systematic approach that integrates data collection, processing, and algorithmic analysis.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-data-collection">4.1 Data Collection<a href="#41-data-collection" class="hash-link" aria-label="Direct link to 4.1 Data Collection" title="Direct link to 4.1 Data Collection">​</a></h3>
<p>Effective estimation begins with the acquisition of accurate and reliable data from the battery system.</p>
<ul>
<li><strong>Terminal Voltage</strong>: Measure the voltage across the battery terminals using voltage sensors.</li>
<li><strong>Current</strong>: Monitor the current flowing into or out of the battery using current sensors.</li>
<li><strong>Temperature</strong>: Track the battery temperature using temperature sensors.</li>
<li><strong>Open-Circuit Voltage (OCV)</strong>: Measure OCV when the battery is at rest for the OCV-based SoC estimation.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-cycle-counting-and-capacity-loss-estimation">4.2 Cycle Counting and Capacity Loss Estimation<a href="#42-cycle-counting-and-capacity-loss-estimation" class="hash-link" aria-label="Direct link to 4.2 Cycle Counting and Capacity Loss Estimation" title="Direct link to 4.2 Cycle Counting and Capacity Loss Estimation">​</a></h3>
<ol>
<li>
<p><strong>Calculate Depth of Discharge (DoD)</strong>:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>DoD</mtext><mo>=</mo><mfrac><mtext>Energy Discharged</mtext><mtext>Battery Capacity</mtext></mfrac><mo>×</mo><mn>100</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">\text{DoD} = \frac{\text{Energy Discharged}}{\text{Battery Capacity}} \times 100\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord text"><span class="mord">DoD</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord text"><span class="mord">Battery Capacity</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord text"><span class="mord">Energy Discharged</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em"></span><span class="mord">100%</span></span></span></span></span>
</li>
<li>
<p><strong>Accumulate DoD Values</strong>:</p>
<p>Normalize partial cycles to equivalent full cycles.</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Equivalent Full Cycles</mtext><mo>=</mo><mfrac><mtext>DoD</mtext><mrow><mn>100</mn><mi mathvariant="normal">%</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{Equivalent Full Cycles} = \frac{\text{DoD}}{100\%}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">Equivalent Full Cycles</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.1019em;vertical-align:-0.7416em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">100%</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord text"><span class="mord">DoD</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7416em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
</li>
<li>
<p><strong>Estimate Capacity Loss</strong>:</p>
<p>Use the total number of equivalent full cycles to determine capacity loss.</p>
</li>
<li>
<p><strong>Compute SoH</strong>:</p>
<p>Apply the capacity loss to calculate SoH.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-soc-estimation">4.3 SoC Estimation<a href="#43-soc-estimation" class="hash-link" aria-label="Direct link to 4.3 SoC Estimation" title="Direct link to 4.3 SoC Estimation">​</a></h3>
<ol>
<li>
<p><strong>Initial SoC Estimation</strong>:</p>
<p>Utilize the OCV method to establish the initial SoC when the battery is at rest.</p>
</li>
<li>
<p><strong>Dynamic SoC Update</strong>:</p>
<p>Implement Coulomb counting to update SoC in real-time during battery operation.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Combined SoC Estimation Process</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> initial_SOC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">estimate_SOC_OCV</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">measured_ocv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> updated_SOC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> initial_SOC</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">update_SOC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> current</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> delta_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> battery_capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    updated_SOC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">estimate_SOC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> delta_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> updated_SOC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> battery_capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-soh-estimation">4.4 SoH Estimation<a href="#44-soh-estimation" class="hash-link" aria-label="Direct link to 4.4 SoH Estimation" title="Direct link to 4.4 SoH Estimation">​</a></h3>
<ol>
<li>
<p><strong>Calculate Current Capacity</strong>:</p>
<p>Subtract the estimated capacity loss from the original capacity.</p>
</li>
<li>
<p><strong>Compute SoH</strong>:</p>
<p>Use the SoH formula to determine the battery&#x27;s health status.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Combined SoH Estimation Process</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> current_capacity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> original_capacity </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">total_cycles </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> capacity_loss_per_cycle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> soh </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">estimate_SOH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_capacity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> original_capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-practical-implementation-in-bms">5. Practical Implementation in BMS<a href="#5-practical-implementation-in-bms" class="hash-link" aria-label="Direct link to 5. Practical Implementation in BMS" title="Direct link to 5. Practical Implementation in BMS">​</a></h2>
<p>Implementing SoC and SoH estimation within a BMS involves integrating the aforementioned algorithms into the system&#x27;s software architecture. The following steps outline the practical workflow:</p>
<ol>
<li>
<p><strong>Data Acquisition</strong>: Continuously collect sensor data (voltage, current, temperature) from the battery modules via slave units.</p>
</li>
<li>
<p><strong>Initial SoC Estimation</strong>:</p>
<ul>
<li>When the battery is at rest, measure the OCV.</li>
<li>Use the OCV-SoC lookup table or curve to estimate the initial SoC.</li>
</ul>
</li>
<li>
<p><strong>Cycle Counting</strong>:</p>
<ul>
<li>Track each charge-discharge cycle and calculate the DoD.</li>
<li>Accumulate partial cycles to estimate the total number of equivalent full cycles.</li>
</ul>
</li>
<li>
<p><strong>Capacity Loss Estimation</strong>:</p>
<ul>
<li>Utilize a lookup table or empirical model to determine capacity loss based on the total cycle count.</li>
</ul>
</li>
<li>
<p><strong>SoH Calculation</strong>:</p>
<ul>
<li>Calculate the current capacity by subtracting the capacity loss from the original capacity.</li>
<li>Compute SoH using the current and original capacity values.</li>
</ul>
</li>
<li>
<p><strong>Dynamic SoC Update</strong>:</p>
<ul>
<li>During operation, employ Coulomb counting to update SoC based on real-time current measurements.</li>
</ul>
</li>
<li>
<p><strong>Integration and Communication</strong>:</p>
<ul>
<li>Integrate SoC and SoH estimates into the BMS&#x27;s overall monitoring and control logic.</li>
<li>Communicate the estimated SoC and SoH to the Vehicle Control Unit (VCU) and other relevant systems for informed decision-making.</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-workflow">Example Workflow:<a href="#example-workflow" class="hash-link" aria-label="Direct link to Example Workflow:" title="Direct link to Example Workflow:">​</a></h4>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Initialize BMS Parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> original_capacity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// in Ah</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> capacity_loss_per_cycle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// in Ah</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> total_cycles </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Initial SoC Estimation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> measured_ocv </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readOCV</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> initial_SOC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">estimate_SOC_OCV</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">measured_ocv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> current_SOC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> initial_SOC</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Main Control Loop</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Data Acquisition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> current </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readCurrentSensor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> voltage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readVoltageSensor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> temperature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readTemperatureSensor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> delta_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getDeltaTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Time since last update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Update SoC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    current_SOC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">estimate_SOC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> delta_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> current_SOC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> original_capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Cycle Counting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> dod </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">calculate_DoD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">voltage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> original_capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total_cycles </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">calculate_equivalent_cycles</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dod</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Capacity Loss Estimation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> capacity_loss </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> total_cycles </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> capacity_loss_per_cycle</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> current_capacity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> original_capacity </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> capacity_loss</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// SoH Calculation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> soh </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">estimate_SOH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_capacity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> original_capacity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Communication with VCU</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">send_SOC_SoH_to_VCU</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_SOC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> soh</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Safety and Control Actions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">enforceSafetyLimits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">voltage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> current</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> temperature</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">delay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Update interval (e.g., 1 second)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Note: The above example is a simplified representation. Actual implementations may require more sophisticated error handling and calibration mechanisms.</em></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-summary-of-soc-and-soh-estimation">6. Summary of SoC and SoH Estimation<a href="#6-summary-of-soc-and-soh-estimation" class="hash-link" aria-label="Direct link to 6. Summary of SoC and SoH Estimation" title="Direct link to 6. Summary of SoC and SoH Estimation">​</a></h2>
<p>Understanding and accurately estimating SoC and SoH are pivotal for effective battery management. The methods outlined ensure that the BMS can provide reliable information for optimal battery operation and longevity.</p>
<table><thead><tr><th><strong>Parameter</strong></th><th><strong>Method</strong></th><th><strong>Key Steps</strong></th></tr></thead><tbody><tr><td><strong>State of Charge (SoC)</strong></td><td>Open-Circuit Voltage (OCV) Method</td><td>Measure OCV, use lookup table to estimate SoC.</td></tr><tr><td></td><td>Coulomb Counting Method</td><td>Integrate current over time, update SoC based on initial value.</td></tr><tr><td><strong>State of Health (SoH)</strong></td><td>Capacity Loss Estimation</td><td>Track cycles, estimate capacity loss, compute SoH as current/original capacity.</td></tr><tr><td></td><td>Cycle Counting</td><td>Measure DoD, accumulate equivalent cycles, map to capacity loss.</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-challenges-and-future-directions">7. Challenges and Future Directions<a href="#7-challenges-and-future-directions" class="hash-link" aria-label="Direct link to 7. Challenges and Future Directions" title="Direct link to 7. Challenges and Future Directions">​</a></h2>
<p>While significant advancements have been made in SoC and SoH estimation, several challenges persist that require ongoing research and development.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="71-accuracy">7.1 Accuracy<a href="#71-accuracy" class="hash-link" aria-label="Direct link to 7.1 Accuracy" title="Direct link to 7.1 Accuracy">​</a></h3>
<ul>
<li><strong>Sensor Precision</strong>: High-precision sensors are essential for minimizing errors in voltage and current measurements.</li>
<li><strong>Algorithm Calibration</strong>: Continuous calibration of estimation algorithms is necessary to account for changes in battery behavior over time and under varying conditions.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="72-aging-effects">7.2 Aging Effects<a href="#72-aging-effects" class="hash-link" aria-label="Direct link to 7.2 Aging Effects" title="Direct link to 7.2 Aging Effects">​</a></h3>
<ul>
<li><strong>Dynamic Modeling</strong>: Developing models that accurately reflect the aging process of batteries to improve SoH estimation.</li>
<li><strong>Adaptive Algorithms</strong>: Implementing algorithms that adapt to the changing characteristics of the battery as it ages.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="73-real-time-implementation">7.3 Real-Time Implementation<a href="#73-real-time-implementation" class="hash-link" aria-label="Direct link to 7.3 Real-Time Implementation" title="Direct link to 7.3 Real-Time Implementation">​</a></h3>
<ul>
<li><strong>Computational Efficiency</strong>: Designing algorithms that can run efficiently on embedded systems with limited processing power.</li>
<li><strong>Latency Reduction</strong>: Ensuring that SoC and SoH estimations are updated promptly to reflect real-time battery states.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="74-environmental-factors">7.4 Environmental Factors<a href="#74-environmental-factors" class="hash-link" aria-label="Direct link to 7.4 Environmental Factors" title="Direct link to 7.4 Environmental Factors">​</a></h3>
<ul>
<li><strong>Temperature Variations</strong>: Accounting for the impact of temperature on battery performance and measurement accuracy.</li>
<li><strong>Load Fluctuations</strong>: Managing rapid changes in load conditions to maintain accurate SoC and SoH estimates.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="75-integration-with-advanced-technologies">7.5 Integration with Advanced Technologies<a href="#75-integration-with-advanced-technologies" class="hash-link" aria-label="Direct link to 7.5 Integration with Advanced Technologies" title="Direct link to 7.5 Integration with Advanced Technologies">​</a></h3>
<ul>
<li><strong>Machine Learning and AI</strong>: Leveraging advanced machine learning techniques to enhance the accuracy and adaptability of SoC and SoH estimation algorithms.</li>
<li><strong>IoT Integration</strong>: Utilizing IoT platforms for remote monitoring and data analysis to improve estimation accuracy and enable predictive maintenance.</li>
</ul>
<hr>
<p>By addressing these challenges and leveraging emerging technologies, future BMS designs will achieve greater accuracy, reliability, and efficiency in SoC and SoH estimation, thereby enhancing the overall performance and lifespan of battery systems.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-conclusion">8. Conclusion<a href="#8-conclusion" class="hash-link" aria-label="Direct link to 8. Conclusion" title="Direct link to 8. Conclusion">​</a></h2>
<p>Accurate initial estimation of State of Charge (SoC) and State of Health (SoH) is fundamental to effective battery management. By employing methods such as the Open-Circuit Voltage (OCV) method and Coulomb counting for SoC, and capacity loss calculation and cycle counting for SoH, BMS can provide reliable insights into battery performance and longevity. Integrating these estimation techniques into the BMS design enhances battery utilization, ensures safety, and prolongs battery life, which is critical for applications ranging from electric vehicles to renewable energy storage systems.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/CagriCatik/Battery-Systems-Technology/edit/main/docs/theory/09_bms_architecture/04_initial_soc.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Battery-Systems-Technology/docs/theory/bms_architecture/development_trends"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Development Trends</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Battery-Systems-Technology/docs/theory/bms_architecture/bms_design"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">BMS Design</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-overview-of-soc-and-soh-estimation" class="table-of-contents__link toc-highlight">1. Overview of SoC and SoH Estimation</a><ul><li><a href="#11-state-of-charge-soc" class="table-of-contents__link toc-highlight">1.1 State of Charge (SoC)</a></li><li><a href="#12-state-of-health-soh" class="table-of-contents__link toc-highlight">1.2 State of Health (SoH)</a></li></ul></li><li><a href="#2-initial-soc-estimation" class="table-of-contents__link toc-highlight">2. Initial SoC Estimation</a><ul><li><a href="#21-open-circuit-voltage-ocv-method" class="table-of-contents__link toc-highlight">2.1 Open-Circuit Voltage (OCV) Method</a></li><li><a href="#22-coulomb-counting-method" class="table-of-contents__link toc-highlight">2.2 Coulomb Counting Method</a></li></ul></li><li><a href="#3-initial-soh-estimation" class="table-of-contents__link toc-highlight">3. Initial SoH Estimation</a><ul><li><a href="#31-capacity-loss-calculation" class="table-of-contents__link toc-highlight">3.1 Capacity Loss Calculation</a></li><li><a href="#32-cycle-counting" class="table-of-contents__link toc-highlight">3.2 Cycle Counting</a></li></ul></li><li><a href="#4-mathematical-and-logical-steps-for-soc-and-soh-estimation" class="table-of-contents__link toc-highlight">4. Mathematical and Logical Steps for SoC and SoH Estimation</a><ul><li><a href="#41-data-collection" class="table-of-contents__link toc-highlight">4.1 Data Collection</a></li><li><a href="#42-cycle-counting-and-capacity-loss-estimation" class="table-of-contents__link toc-highlight">4.2 Cycle Counting and Capacity Loss Estimation</a></li><li><a href="#43-soc-estimation" class="table-of-contents__link toc-highlight">4.3 SoC Estimation</a></li><li><a href="#44-soh-estimation" class="table-of-contents__link toc-highlight">4.4 SoH Estimation</a></li></ul></li><li><a href="#5-practical-implementation-in-bms" class="table-of-contents__link toc-highlight">5. Practical Implementation in BMS</a></li><li><a href="#6-summary-of-soc-and-soh-estimation" class="table-of-contents__link toc-highlight">6. Summary of SoC and SoH Estimation</a></li><li><a href="#7-challenges-and-future-directions" class="table-of-contents__link toc-highlight">7. Challenges and Future Directions</a><ul><li><a href="#71-accuracy" class="table-of-contents__link toc-highlight">7.1 Accuracy</a></li><li><a href="#72-aging-effects" class="table-of-contents__link toc-highlight">7.2 Aging Effects</a></li><li><a href="#73-real-time-implementation" class="table-of-contents__link toc-highlight">7.3 Real-Time Implementation</a></li><li><a href="#74-environmental-factors" class="table-of-contents__link toc-highlight">7.4 Environmental Factors</a></li><li><a href="#75-integration-with-advanced-technologies" class="table-of-contents__link toc-highlight">7.5 Integration with Advanced Technologies</a></li></ul></li><li><a href="#8-conclusion" class="table-of-contents__link toc-highlight">8. Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a href="https://github.com/CagriCatik/Battery-Systems-Technology" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a class="footer__link-item" position="left" href="/Battery-Systems-Technology/blog">Blog</a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Battery Systems and Technology</div></div></div></footer></div>
</body>
</html>